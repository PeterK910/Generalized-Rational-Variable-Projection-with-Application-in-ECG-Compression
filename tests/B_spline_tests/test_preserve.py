from B_spline.preserve import preserve
import numpy as np
import numpy.testing as npt

def test_1():
    y=np.array([0.42971,0.3989,0.3989,0.35268,0.3989,0.36808,0.46053,0.50675,0.50675,0.58379,0.58379,0.55297,0.50675,0.52216,0.52216,0.50675,0.53756,0.55297,0.63001,0.55297,0.6146,0.63001,0.64542,0.6146,0.59919,0.58379,0.6146,0.58379,0.52216,0.56838,0.63001,0.6146,0.64542,0.66082,0.63001,0.67623,0.56838,0.55297,0.52216,0.49134,0.49134,0.44512,0.47594,0.50675,0.50675,0.55297,0.49134,0.47594,0.49134,0.47594,0.46053,0.44512,0.46053,0.50675,0.49134,0.53756,0.59919,0.56838,0.6146,0.6146,0.53756,0.52216,0.46053,0.44512,0.42971,0.46053,0.44512,0.47594,0.47594,0.46053,0.44512,0.46053,0.42971,0.38349,0.3989,0.41431,0.33727,0.3989,0.3989,0.41431,0.3989,0.42971,0.46053,0.42971,0.42971,0.36808,0.33727,0.36808,0.33727,0.29105,0.36808,0.38349,0.3989,0.46053,0.44512,0.41431,0.38349,0.3989,0.35268,0.36808,0.33727,0.3989,0.44512,0.47594,0.53756,0.53756,0.55297,0.58379,0.6146,0.64542,0.70705,0.75327,0.90734,1.0152,1.0768,0.99978,0.76867,0.35268,-0.10954,-0.57176,-1.0956,-1.6041,-2.1433,-2.8366,-3.53,-4.1463,-4.7471,-5.1323,-5.3018,-5.4251,-5.4559,-5.5021,-5.4867,-5.4867,-5.4867,-5.4251,-5.2402,-5.0091,-4.6547,-4.362,-4.0692,-3.7611,-3.5146,-3.2372,-2.9291,-2.7288,-2.5285,-2.3436,-2.0817,-1.8506,-1.5578,-1.2651,-1.034,-0.71043,-0.32524,-0.017098,0.26023,0.46053,0.53756,0.50675,0.53756,0.55297,0.66082,0.72245,0.86112,0.92275,1.046,1.0768,1.0306,1.0922,1.0306,1.046,1.0768,1.0768,1.1384,1.1693,1.2771,1.3233,1.3079,1.3079,1.3542,1.3079,1.3233,1.3542,1.3696,1.4158,1.4466,1.5544,1.5853,1.7085,1.7393,1.8164,1.8318,1.878,1.9088,1.9088,1.9396,2.0783,2.1553,2.2478,2.294,2.4018,2.5097,2.5251,2.5713,2.5251,2.5405,2.5251,2.4943,2.5405,2.5559,2.5713,2.633,2.71,2.8178,2.9257,2.9873,2.9257,3.0027,2.9873,3.049,3.1568,3.203,3.2492,3.3879,3.3571,3.4033,3.3263,3.2492,3.203,3.1568,3.1106,3.0798,3.0181,2.9873,2.9565,2.8641,2.8487,2.6946,2.6176,2.4943,2.3556,2.2478,2.0937,1.9704,1.8318,1.7701,1.7085,1.5853,1.5236,1.385,1.2925,1.1847,1.0922,0.93815,0.90734,0.8149,0.76867,0.70705,0.75327,0.70705,0.72245,0.69164,0.67623,0.64542,0.63001,0.53756,0.52216,0.47594,0.50675,0.52216,0.55297,0.55297,0.63001,0.63001,0.59919,0.64542,0.58379,0.56838,0.55297,0.55297,0.52216,0.56838,0.56838,0.6146,0.64542,0.66082,0.64542,0.63001,0.6146,0.59919,0.52216,0.50675,0.52216,0.55297,0.58379,0.58379,0.63001,0.67623,0.64542,0.59919,0.58379,0.6146,0.52216,0.58379,0.52216,0.56838,0.6146,0.6146,0.64542,0.63001,0.59919,0.6146,0.50675,0.49134,0.49134,0.50675,0.46053,0.47594,0.53756,0.55297,0.59919,0.58379,0.56838,0.53756,0.50675,0.52216,0.42971,0.42971,0.3989,0.42971,0.46053,0.46053,0.52216,0.49134,0.44512,0.42971,0.41431,0.41431,0.38349,0.36808,0.36808,0.41431,0.42971,0.44512,0.46053,0.44512,0.47594,0.44512,0.3989,0.3989,0.32186,0.36808,0.33727,0.35268,0.38349,0.38349,0.41431,0.41431,0.32186,0.38349,0.33727,0.27564,0.30646,0.30646,0.30646,0.38349,0.36808,0.38349,0.38349,0.41431,0.41431,0.33727,0.32186,0.36808,0.30646,0.29105,0.27564,0.30646,0.30646,0.35268,0.36808,0.33727,0.36808,0.33727,0.32186,0.32186,0.29105,0.29105,0.29105,0.29105,0.35268,0.38349,0.41431,0.41431,0.38349,0.38349,0.33727,0.32186,0.27564,0.26023,0.22942,0.27564,0.26023,0.32186,0.35268,0.29105,0.35268,0.35268,0.30646,0.29105,0.30646,0.22942,0.29105,0.24483,0.32186,0.32186,0.35268,0.32186,0.32186,0.29105,0.24483,0.22942,0.15238,0.1986,0.1832,0.16779,0.1832,0.29105,0.30646,0.30646,0.32186,0.29105,0.30646,0.21401,0.16779,0.15238,0.16779,0.1832,0.21401,0.22942,0.1986,0.27564,0.26023,0.26023,0.1986,0.1986,0.12157,0.090753,0.10616,0.1832,0.22942,0.29105,0.30646,0.33727,0.29105,0.35268,0.26023,0.21401,0.16779,0.1832,0.21401,0.24483,0.22942,0.27564,0.32186,0.29105,0.22942,0.29105,0.22942,0.22942,0.15238,0.16779,0.1832,0.27564])
    x=np.arange(1, len(y)+1)
    
    expected_yy=np.array([0,-0.03049,-0.030165,-0.076061,-0.029514,-0.060004,0.032765,0.079312,0.079637,0.157,0.15732,0.12683,0.080937,0.096669,0.096994,0.081912,0.11305,0.12878,0.20615,0.12943,0.19139,0.20712,0.22285,0.19236,0.17728,0.1622,0.19334,0.16285,0.10155,0.14809,0.21005,0.19496,0.2261,0.24184,0.21135,0.25789,0.15037,0.13529,0.1048,0.074306,0.074631,0.028734,0.059874,0.091014,0.091339,0.13789,0.076581,0.061499,0.077232,0.062149,0.047067,0.031985,0.047717,0.094264,0.079182,0.12573,0.18768,0.15719,0.20374,0.20407,0.12735,0.11227,0.050968,0.035885,0.020803,0.051943,0.036861,0.068,0.068325,0.053243,0.038161,0.053893,0.023403,-0.022493,-0.006761,0.0089713,-0.06774,-0.0057859,-0.0054608,0.010272,-0.0048107,0.026329,0.057469,0.026979,0.027304,-0.034,-0.06449,-0.03335,-0.06384,-0.10974,-0.032375,-0.016642,-0.00091014,0.061044,0.045962,0.015472,-0.015017,0.00071511,-0.045182,-0.029449,-0.059939,0.0020153,0.048562,0.079702,0.14166,0.14198,0.15771,0.18885,0.21999,0.25113,0.31309,0.35963,0.51403,0.62221,0.68416,0.60745,0.37667,-0.039006,-0.5009,-0.96279,-1.4863,-1.9944,-2.5334,-3.2264,-3.9194,-4.5353,-5.1359,-5.5208,-5.6899,-5.8128,-5.8433,-5.8892,-5.8735,-5.8732,-5.8728,-5.8109,-5.6257,-5.3942,-5.0396,-4.7465,-4.4534,-4.145,-3.8981,-3.6205,-3.312,-3.1114,-2.9107,-2.7255,-2.4633,-2.2318,-1.9388,-1.6457,-1.4143,-1.0904,-0.7049,-0.39643,-0.11877,0.081847,0.15921,0.12872,0.15986,0.17559,0.28377,0.34572,0.48471,0.54667,0.67025,0.70139,0.65549,0.71745,0.65614,0.67188,0.70302,0.70334,0.76529,0.79643,0.90461,0.95116,0.93607,0.9364,0.98295,0.93705,0.95278,0.98392,0.99965,1.0462,1.0773,1.1855,1.2167,1.3402,1.3714,1.4487,1.4645,1.511,1.5422,1.5425,1.5736,1.7126,1.79,1.8827,1.9293,2.0375,2.1456,2.1614,2.2079,2.162,2.1778,2.1627,2.1322,2.1787,2.1945,2.2102,2.2722,2.3495,2.4577,2.5659,2.6278,2.5665,2.6439,2.6288,2.6908,2.7989,2.8455,2.892,3.031,3.0005,3.0471,2.9704,2.8936,2.8478,2.8019,2.756,2.7255,2.6642,2.6337,2.6032,2.5111,2.496,2.3422,2.2655,2.1426,2.0042,1.8967,1.743,1.62,1.4817,1.4204,1.3591,1.2362,1.1749,1.0365,0.9444,0.83687,0.74475,0.591,0.56051,0.46839,0.4225,0.36119,0.40774,0.36184,0.37758,0.34709,0.332,0.30152,0.28643,0.19431,0.17923,0.13333,0.16447,0.18021,0.21135,0.21167,0.28903,0.28936,0.25887,0.30542,0.24411,0.22903,0.21395,0.21427,0.18378,0.23033,0.23065,0.2772,0.30834,0.32407,0.30899,0.29391,0.27883,0.26374,0.18703,0.17195,0.18768,0.21882,0.24996,0.25029,0.29683,0.34338,0.31289,0.26699,0.25191,0.28305,0.19093,0.25289,0.19158,0.23813,0.28468,0.285,0.31614,0.30106,0.27057,0.2863,0.17878,0.16369,0.16402,0.17975,0.13385,0.14959,0.21154,0.22727,0.27382,0.25874,0.24366,0.21317,0.18268,0.19841,0.10629,0.10662,0.076126,0.10727,0.13841,0.13873,0.20068,0.1702,0.1243,0.10922,0.094134,0.094459,0.06397,0.048887,0.049212,0.095759,0.11149,0.12722,0.14296,0.12787,0.15901,0.12852,0.082627,0.082952,0.0062409,0.052788,0.022298,0.038031,0.06917,0.069495,0.10064,0.10096,0.0088413,0.070796,0.024899,-0.036405,-0.0052658,-0.0049407,-0.0046157,0.072746,0.057664,0.073396,0.073721,0.10486,0.10519,0.028474,0.013392,0.059939,-0.0013652,-0.016447,-0.03153,-0.00039006,-6.501e-05,0.046482,0.062214,0.031725,0.062864,0.032375,0.017293,0.017618,-0.012872,-0.012547,-0.012222,-0.011897,0.050057,0.081197,0.11234,0.11266,0.082172,0.082497,0.0366,0.021518,-0.024379,-0.039461,-0.06995,-0.023403,-0.038486,0.023469,0.054608,-0.006696,0.055258,0.055583,0.0096864,-0.0053958,0.010337,-0.066375,-0.0044207,-0.050318,0.027044,0.027369,0.058509,0.028019,0.028344,-0.0021453,-0.048042,-0.063124,-0.13984,-0.093289,-0.10837,-0.12345,-0.10772,0.00045507,0.016187,0.016512,0.032245,0.0017553,0.017488,-0.074631,-0.12053,-0.13561,-0.11988,-0.10415,-0.073006,-0.057274,-0.087763,-0.010402,-0.025484,-0.025159,-0.086463,-0.086138,-0.16285,-0.19334,-0.17761,-0.10024,-0.053698,0.0082562,0.023989,0.055128,0.0092314,0.071186,-0.020933,-0.06683,-0.11273,-0.096994,-0.065855,-0.034715,-0.049797,-0.0032505,0.043296,0.012807,-0.048497,0.013457,-0.047847,-0.047522,-0.12423,-0.1085,-0.092769,0])
    yy=preserve(x, y)

    npt.assert_array_almost_equal(np.round(yy, 4), expected_yy, 4)
